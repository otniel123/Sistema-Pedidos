DROP DATABASE IF EXISTS pedidos_online;

CREATE DATABASE pedidos_online
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE pedidos_online;

CREATE TABLE clientes (
    id_cliente INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    telefone VARCHAR(15),
    cpf VARCHAR(11) UNIQUE,
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB;

CREATE TABLE produtos (
    id_produto INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(100) NOT NULL,
    descricao TEXT,
    preco DECIMAL(10, 2) NOT NULL,
    estoque INT NOT NULL DEFAULT 0,
    data_cadastro TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT chk_preco CHECK (preco >= 0),
    CONSTRAINT chk_estoque CHECK (estoque >= 0)
) ENGINE=InnoDB;

CREATE TABLE pedidos (
    id_pedido INT PRIMARY KEY AUTO_INCREMENT,
    id_cliente INT NOT NULL,
    id_produto INT NOT NULL,
    quantidade INT NOT NULL,
    valor_total DECIMAL(10, 2) NOT NULL,
    data_pedido TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    status ENUM('PENDENTE', 'CONFIRMADO', 'ENVIADO', 'ENTREGUE', 'CANCELADO') DEFAULT 'PENDENTE',

    CONSTRAINT fk_pedidos_cliente
        FOREIGN KEY (id_cliente) REFERENCES clientes(id_cliente)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    CONSTRAINT fk_pedidos_produto
        FOREIGN KEY (id_produto) REFERENCES produtos(id_produto)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    CONSTRAINT chk_quantidade CHECK (quantidade > 0),
    CONSTRAINT chk_valor_total CHECK (valor_total >= 0)
) ENGINE=InnoDB;

CREATE INDEX idx_clientes_email ON clientes(email);
CREATE INDEX idx_clientes_cpf ON clientes(cpf);
CREATE INDEX idx_produtos_nome ON produtos(nome);
CREATE INDEX idx_pedidos_cliente ON pedidos(id_cliente);
CREATE INDEX idx_pedidos_produto ON pedidos(id_produto);
CREATE INDEX idx_pedidos_status ON pedidos(status);

INSERT INTO clientes (nome, email, telefone, cpf) VALUES
('João Silva', 'joao.silva@email.com', '11987654321', '12345678901'),
('Maria Santos', 'maria.santos@email.com', '11876543210', '23456789012'),
('Pedro Oliveira', 'pedro.oliveira@email.com', '11765432109', '34567890123'),
('Ana Costa', 'ana.costa@email.com', '11654321098', '45678901234');

INSERT INTO produtos (nome, descricao, preco, estoque) VALUES
('Notebook Dell', 'Notebook Dell Inspiron 15, 8GB RAM, 256GB SSD', 3500.00, 10),
('Mouse Logitech', 'Mouse sem fio Logitech M280', 85.00, 50),
('Teclado Mecânico', 'Teclado mecânico RGB Redragon', 250.00, 30),
('Monitor LG', 'Monitor LG 24 polegadas Full HD', 800.00, 15),
('Webcam Logitech', 'Webcam Full HD 1080p', 350.00, 25);

INSERT INTO pedidos (id_cliente, id_produto, quantidade, valor_total, status) VALUES
(1, 1, 1, 3500.00, 'CONFIRMADO'),
(1, 2, 2, 170.00, 'ENTREGUE'),
(2, 3, 1, 250.00, 'ENVIADO'),
(2, 4, 1, 800.00, 'CONFIRMADO'),
(3, 2, 3, 255.00, 'PENDENTE'),
(4, 5, 1, 350.00, 'CONFIRMADO'),
(4, 3, 2, 500.00, 'ENTREGUE');